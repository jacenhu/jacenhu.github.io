<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基于ghz进行gRpc框架性能压测（1） | Jacen&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    <link rel="apple-touch-icon" href="./favicon.ico">
    <meta name="description" content="my personal blog">
    
    <link rel="preload" href="/assets/css/0.styles.2888696b.css" as="style"><link rel="preload" href="/assets/js/app.7cef2ded.js" as="script"><link rel="preload" href="/assets/js/2.6425c107.js" as="script"><link rel="preload" href="/assets/js/8.13fc1817.js" as="script"><link rel="prefetch" href="/assets/js/10.1481c12a.js"><link rel="prefetch" href="/assets/js/11.b64d3f3a.js"><link rel="prefetch" href="/assets/js/12.96e5f91e.js"><link rel="prefetch" href="/assets/js/13.d1468c6a.js"><link rel="prefetch" href="/assets/js/14.b4c40127.js"><link rel="prefetch" href="/assets/js/15.c1c602a7.js"><link rel="prefetch" href="/assets/js/16.7a6d193e.js"><link rel="prefetch" href="/assets/js/17.af99f69e.js"><link rel="prefetch" href="/assets/js/18.cc859287.js"><link rel="prefetch" href="/assets/js/19.15845952.js"><link rel="prefetch" href="/assets/js/20.60a13ab7.js"><link rel="prefetch" href="/assets/js/21.2fa8c7be.js"><link rel="prefetch" href="/assets/js/22.28715219.js"><link rel="prefetch" href="/assets/js/23.41ee1728.js"><link rel="prefetch" href="/assets/js/24.95f7c70f.js"><link rel="prefetch" href="/assets/js/25.93b0634c.js"><link rel="prefetch" href="/assets/js/26.b11b7c9b.js"><link rel="prefetch" href="/assets/js/27.3c5b23a8.js"><link rel="prefetch" href="/assets/js/28.de8f98d1.js"><link rel="prefetch" href="/assets/js/29.1c4c62bb.js"><link rel="prefetch" href="/assets/js/3.b11b99ee.js"><link rel="prefetch" href="/assets/js/30.09dc3858.js"><link rel="prefetch" href="/assets/js/31.759236ff.js"><link rel="prefetch" href="/assets/js/32.cf88ca34.js"><link rel="prefetch" href="/assets/js/33.539019c1.js"><link rel="prefetch" href="/assets/js/34.cbbf120b.js"><link rel="prefetch" href="/assets/js/35.d1c27a8d.js"><link rel="prefetch" href="/assets/js/36.37ed2443.js"><link rel="prefetch" href="/assets/js/37.c13152c3.js"><link rel="prefetch" href="/assets/js/38.f8ccb31d.js"><link rel="prefetch" href="/assets/js/39.fa955ad2.js"><link rel="prefetch" href="/assets/js/4.85748413.js"><link rel="prefetch" href="/assets/js/40.08282f43.js"><link rel="prefetch" href="/assets/js/41.41671f66.js"><link rel="prefetch" href="/assets/js/42.1a50238c.js"><link rel="prefetch" href="/assets/js/43.095f995a.js"><link rel="prefetch" href="/assets/js/44.6f5eb2ef.js"><link rel="prefetch" href="/assets/js/45.0f2e41f0.js"><link rel="prefetch" href="/assets/js/5.221eefda.js"><link rel="prefetch" href="/assets/js/6.8d9dca1c.js"><link rel="prefetch" href="/assets/js/7.f4f80172.js"><link rel="prefetch" href="/assets/js/9.a8851229.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2888696b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Jacen's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/program/" class="nav-link router-link-active">
  技术
</a></div><div class="nav-item"><a href="/books/" class="nav-link">
  阅读
</a></div><div class="nav-item"><a href="https://www.zhihu.com/people/jacenhu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  知乎
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/jacenhu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.jianshu.com/u/9c488588c366" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://juejin.cn/user/2796746683466984/activities" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/program/" class="nav-link router-link-active">
  技术
</a></div><div class="nav-item"><a href="/books/" class="nav-link">
  阅读
</a></div><div class="nav-item"><a href="https://www.zhihu.com/people/jacenhu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  知乎
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/jacenhu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.jianshu.com/u/9c488588c366" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://juejin.cn/user/2796746683466984/activities" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JAVA后端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>C++</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/program/cpp/CppPrimer.html" class="sidebar-link">C++ Primer</a></li><li><a href="/program/cpp/dataStructure.html" class="sidebar-link">常用数据结构与算法</a></li><li><a href="/program/cpp/HTTPIP.html" class="sidebar-link">TCP/IP详解卷一</a></li><li><a href="/program/cpp/Ceph.html" class="sidebar-link">分布式存储系统Ceph</a></li><li><a href="/program/cpp/CppKnowledge.html" class="sidebar-link">C++开发知识点整理</a></li><li><a href="/program/cpp/TCPSummary.html" class="sidebar-link">TCP/IP协议知识总结</a></li><li><a href="/program/cpp/linuxCommand.html" class="sidebar-link">linux系统命令</a></li><li><a href="/program/cpp/Abstract.html" class="sidebar-link">计算机术语概念解释（持续更新）</a></li><li><a href="/program/cpp/vscodeCpp.html" class="sidebar-link">vscode运行C++</a></li><li><a href="/program/cpp/JD.html" class="sidebar-link">从招聘信息看分布式存储需掌握既能</a></li><li><a href="/program/cpp/mempool.html" class="sidebar-link">内存池设计相关参考</a></li><li><a href="/program/cpp/CodingInterviewSummary.html" class="sidebar-link">《剑指offer》小结</a></li><li><a href="/program/cpp/lowCode.html" class="sidebar-link">什么是低代码</a></li><li><a href="/program/cpp/DataLakeWhat.html" class="sidebar-link">什么是数据湖？及其架构</a></li><li><a href="/program/cpp/designPattern.html" class="sidebar-link">23种设计模式（updating）</a></li><li><a href="/program/cpp/ghz_chapter1.html" aria-current="page" class="active sidebar-link">基于ghz进行gRpc框架性能压测（1）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/program/cpp/ghz_chapter1.html#_1-ghz介绍" class="sidebar-link">1 ghz介绍</a></li><li class="sidebar-sub-header"><a href="/program/cpp/ghz_chapter1.html#_2-ghz下载与安装" class="sidebar-link">2 ghz下载与安装</a></li><li class="sidebar-sub-header"><a href="/program/cpp/ghz_chapter1.html#_3-ghz命令行" class="sidebar-link">3 ghz命令行</a></li><li class="sidebar-sub-header"><a href="/program/cpp/ghz_chapter1.html#_4-程序准备" class="sidebar-link">4 程序准备</a></li><li class="sidebar-sub-header"><a href="/program/cpp/ghz_chapter1.html#_5-参考资料" class="sidebar-link">5 参考资料</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>论文</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>实践</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="基于ghz进行grpc框架性能压测-1"><a href="#基于ghz进行grpc框架性能压测-1" class="header-anchor">#</a> 基于ghz进行gRpc框架性能压测（1）</h1> <h2 id="_1-ghz介绍"><a href="#_1-ghz介绍" class="header-anchor">#</a> 1 ghz介绍</h2> <p>ghz是一个命令行程序和Go包，用于负载测试和gRPC服务的基准测试。</p> <h2 id="_2-ghz下载与安装"><a href="#_2-ghz下载与安装" class="header-anchor">#</a> 2 ghz下载与安装</h2> <p>step1 在https://github.com/bojand/ghz/releases下载对应环境的ghz二进制包。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">wget</span> https://github.com/bojand/ghz/releases/download/v0.110.0/ghz-linux-x86_64.tar.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/wget_ghz.1142bce2.png" alt="download ghz package"></p> <p>step2 解压ghz压缩包，可得到二进制执行程序文件。</p> <p>解决后的目录结构如下：</p> <p><img src="/assets/img/unarchive_ghz.9ccba330.png" alt="unarchive ghz package"></p> <h2 id="_3-ghz命令行"><a href="#_3-ghz命令行" class="header-anchor">#</a> 3 ghz命令行</h2> <p>执行./gzh -h，得到ghz的命令行说明</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>
usage: ghz <span class="token punctuation">[</span><span class="token operator">&lt;</span>flags<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>host<span class="token operator">&gt;</span><span class="token punctuation">]</span>

Flags:
  -h, <span class="token parameter variable">--help</span>                     Show context-sensitive <span class="token builtin class-name">help</span> <span class="token punctuation">(</span>also try --help-long and --help-man<span class="token punctuation">)</span>.
      <span class="token parameter variable">--config</span><span class="token operator">=</span>                  Path to the JSON or TOML config <span class="token function">file</span> that specifies all the <span class="token builtin class-name">test</span> run settings.
      <span class="token parameter variable">--proto</span><span class="token operator">=</span>                   The Protocol Buffer .proto file.
      <span class="token parameter variable">--protoset</span><span class="token operator">=</span>                The compiled protoset file. Alternative to proto. <span class="token parameter variable">-proto</span> takes precedence.
      <span class="token parameter variable">--call</span><span class="token operator">=</span>                    A fully-qualified method name <span class="token keyword">in</span> <span class="token string">'package.Service/method'</span> or <span class="token string">'package.Service.Method'</span> format.
  -i, --import-paths<span class="token operator">=</span>            Comma separated list of proto <span class="token function">import</span> paths. The current working directory and the directory of the protocol buffer
                                 <span class="token function">file</span> are automatically added to the <span class="token function">import</span> list.
      <span class="token parameter variable">--cacert</span><span class="token operator">=</span>                  File containing trusted root certificates <span class="token keyword">for</span> verifying the server.
      <span class="token parameter variable">--cert</span><span class="token operator">=</span>                    File containing client certificate <span class="token punctuation">(</span>public key<span class="token punctuation">)</span>, to present to the server. Must also provide <span class="token parameter variable">-key</span> option.
      <span class="token parameter variable">--key</span><span class="token operator">=</span>                     File containing client private key, to present to the server. Must also provide <span class="token parameter variable">-cert</span> option.
      <span class="token parameter variable">--cname</span><span class="token operator">=</span>                   Server name override when validating TLS certificate - useful <span class="token keyword">for</span> self signed certs.
      <span class="token parameter variable">--skipTLS</span>                  Skip TLS client verification of the server<span class="token string">'s certificate chain and host name.
      --insecure                 Use plaintext and insecure connection.
      --authority=               Value to be used as the :authority pseudo-header. Only works if -insecure is used.
      --async                    Make requests asynchronous as soon as possible. Does not wait for request to finish before sending next one.
  -r, --rps=0                    Requests per second (RPS) rate limit for constant load schedule. Default is no rate limit.
      --load-schedule=&quot;const&quot;    Specifies the load schedule. Options are const, step, or line. Default is const.
      --load-start=0             Specifies the RPS load start value for step or line schedules.
      --load-step=0              Specifies the load step value or slope value.
      --load-end=0               Specifies the load end value for step or line load schedules.
      --load-step-duration=0     Specifies the load step duration value for step load schedule.
      --load-max-duration=0      Specifies the max load duration value for step or line load schedule.
  -c, --concurrency=50           Number of request workers to run concurrently for const concurrency schedule. Default is 50.
      --concurrency-schedule=&quot;const&quot;  
                                 Concurrency change schedule. Options are const, step, or line. Default is const.
      --concurrency-start=0      Concurrency start value for step and line concurrency schedules.
      --concurrency-end=0        Concurrency end value for step and line concurrency schedules.
      --concurrency-step=1       Concurrency step / slope value for step and line concurrency schedules.
      --concurrency-step-duration=0  
                                 Specifies the concurrency step duration value for step concurrency schedule.
      --concurrency-max-duration=0  
                                 Specifies the max concurrency adjustment duration value for step or line concurrency schedule.
  -n, --total=200                Number of requests to run. Default is 200.
  -t, --timeout=20s              Timeout for each request. Default is 20s, use 0 for infinite.
  -z, --duration=0               Duration of application to send requests. When duration is reached, application stops and exits. If duration is
                                 specified, n is ignored. Examples: -z 10s -z 3m.
  -x, --max-duration=0           Maximum duration of application to send requests with n setting respected. If duration is reached before n requests
                                 are completed, application stops and exits. Examples: -x 10s -x 3m.
      --duration-stop=&quot;close&quot;    Specifies how duration stop is reported. Options are close, wait or ignore. Default is close.
  -d, --data=                    The call data as stringified JSON. If the value is '</span>@' <span class="token keyword">then</span> the request contents are <span class="token builtin class-name">read</span> from stdin.
  -D, --data-file<span class="token operator">=</span>               File path <span class="token keyword">for</span> call data JSON file. Examples: /home/user/file.json or ./file.json.
  -b, <span class="token parameter variable">--binary</span>                   The call data comes as serialized binary message or multiple count-prefixed messages <span class="token builtin class-name">read</span> from stdin.
  -B, --binary-file<span class="token operator">=</span>             File path <span class="token keyword">for</span> the call data as serialized binary message or multiple count-prefixed messages.
  -m, <span class="token parameter variable">--metadata</span><span class="token operator">=</span>                Request metadata as stringified JSON.
  -M, --metadata-file<span class="token operator">=</span>           File path <span class="token keyword">for</span> call metadata JSON file. Examples: /home/user/metadata.json or ./metadata.json.
      --stream-interval<span class="token operator">=</span><span class="token number">0</span>        Interval <span class="token keyword">for</span> stream requests between message sends.
      --stream-call-duration<span class="token operator">=</span><span class="token number">0</span>   Duration after <span class="token function">which</span> client will close the stream <span class="token keyword">in</span> each streaming call.
      --stream-call-count<span class="token operator">=</span><span class="token number">0</span>      Count of messages sent, after <span class="token function">which</span> client will close the stream <span class="token keyword">in</span> each streaming call.
      --stream-dynamic-messages  In streaming calls, regenerate and apply call template data on every message send.
      --reflect-metadata<span class="token operator">=</span>        Reflect metadata as stringified JSON used only <span class="token keyword">for</span> reflection request.
  -o, <span class="token parameter variable">--output</span><span class="token operator">=</span>                  Output path. If none provided stdout is used.
  -O, <span class="token parameter variable">--format</span><span class="token operator">=</span>                  Output format. One of: summary, csv, json, pretty, html, influx-summary, influx-details. Default is summary.
      <span class="token parameter variable">--skipFirst</span><span class="token operator">=</span><span class="token number">0</span>              Skip the first X requests when doing the results tally.
      --count-errors             Count erroneous <span class="token punctuation">(</span>non-OK<span class="token punctuation">)</span> resoponses <span class="token keyword">in</span> stats calculations.
      <span class="token parameter variable">--connections</span><span class="token operator">=</span><span class="token number">1</span>            Number of connections to use. Concurrency is distributed evenly among all the connections. Default is <span class="token number">1</span>.
      --connect-timeout<span class="token operator">=</span>10s      Connection <span class="token function">timeout</span> <span class="token keyword">for</span> the initial connection dial. Default is 10s.
      <span class="token parameter variable">--keepalive</span><span class="token operator">=</span><span class="token number">0</span>              Keepalive <span class="token function">time</span> duration. Only used <span class="token keyword">if</span> present and above <span class="token number">0</span>.
      <span class="token parameter variable">--name</span><span class="token operator">=</span>                    User specified name <span class="token keyword">for</span> the test.
      <span class="token parameter variable">--tags</span><span class="token operator">=</span>                    JSON representation of user-defined string tags.
      <span class="token parameter variable">--cpus</span><span class="token operator">=</span><span class="token number">4</span>                   Number of cpu cores to use.
      <span class="token parameter variable">--debug</span><span class="token operator">=</span>                   The path to debug log file.
  -e, --enable-compression       Enable Gzip compression on requests.
      --lb-strategy<span class="token operator">=</span>             Client load balancing strategy.
      --max-recv-message-size<span class="token operator">=</span>   Maximum message size the client can receive.
      --max-send-message-size<span class="token operator">=</span>   Maximum message size the client can send.
  -v, <span class="token parameter variable">--version</span>                  Show application version.

Args:
  <span class="token punctuation">[</span><span class="token operator">&lt;</span>host<span class="token operator">&gt;</span><span class="token punctuation">]</span>  Host and port to test.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><h2 id="_4-程序准备"><a href="#_4-程序准备" class="header-anchor">#</a> 4 程序准备</h2> <h3 id="_4-1-编译和安装grpc、protocol-buffers"><a href="#_4-1-编译和安装grpc、protocol-buffers" class="header-anchor">#</a> 4.1 编译和安装gRPC、Protocol Buffers</h3> <h4 id="_4-1-1-安装依赖"><a href="#_4-1-1-安装依赖" class="header-anchor">#</a> 4.1.1 安装依赖</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 开发依赖安装</span>
yum group info <span class="token string">&quot;Development Tools&quot;</span>

yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">git</span> cmake gcc gcc-c++ <span class="token function">make</span> autoconf automake libtool pkg-config
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># pkg-config安葬</span>
<span class="token function">wget</span> https://pkgconfig.freedesktop.org/releases/pkg-config-0.29.2.tar.gz

./configure --with-internal-glib 
<span class="token function">make</span>
<span class="token function">make</span> check
<span class="token function">make</span> <span class="token function">install</span>

pkg-config <span class="token parameter variable">--version</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_4-1-2-下载grpc及其子模块-并编译"><a href="#_4-1-2-下载grpc及其子模块-并编译" class="header-anchor">#</a> 4.1.2 下载grpc及其子模块，并编译</h4> <h5 id="_4-1-2-1-下载grpc源码"><a href="#_4-1-2-1-下载grpc源码" class="header-anchor">#</a> 4.1.2.1 下载grpc源码</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 下载grpc源码</span>
<span class="token builtin class-name">cd</span> /home/jacen/thirdparty
<span class="token function">git</span> clone --recurse-submodules <span class="token parameter variable">-b</span> v1.50.0 <span class="token parameter variable">--depth</span> <span class="token number">1</span> --shallow-submodules https://github.com/grpc/grpc

<span class="token function">git</span> submodule update <span class="token parameter variable">--init</span> <span class="token comment"># 下载任务中断后，继续</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="_4-1-2-2-编译protobuf"><a href="#_4-1-2-2-编译protobuf" class="header-anchor">#</a> 4.1.2.2 编译protobuf</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 编译protobuf</span>
<span class="token function">wget</span> https://github.com/protocolbuffers/protobuf/releases/download/v21.6/protobuf-all-21.6.tar.gz <span class="token comment">#v2.6</span>
./configure <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr/local/protobuf
<span class="token function">make</span> <span class="token parameter variable">-j8</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>
ldconfig
/usr/local/protobuf/bin/protoc <span class="token parameter variable">--version</span> <span class="token comment">#验证</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="_4-1-2-3-编译grpc"><a href="#_4-1-2-3-编译grpc" class="header-anchor">#</a> 4.1.2.3 编译grpc</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 编译grpc</span>

<span class="token comment"># 由于centos 7 gcc版本较低，升级下版本</span>
<span class="token function">ln</span> <span class="token parameter variable">-sf</span> /usr/local/gcc7.3.0/bin/gcc /usr/bin/cc
<span class="token function">ln</span> <span class="token parameter variable">-sf</span> /usr/local/gcc7.3.0/bin/g++ /usr/bin/c++

<span class="token builtin class-name">cd</span> /home/jacen/thirdparty/grpc
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> cmake/build
<span class="token builtin class-name">cd</span> cmake/build

cmake <span class="token parameter variable">-DCMAKE_INSTALL_PREFIX</span><span class="token operator">=</span>/usr/local/grpc <span class="token punctuation">\</span>
       <span class="token parameter variable">-DCMAKE_BUILD_TYPE</span><span class="token operator">=</span>Release <span class="token punctuation">\</span>
       <span class="token parameter variable">-DgRPC_INSTALL</span><span class="token operator">=</span>ON <span class="token punctuation">\</span>
       <span class="token parameter variable">-DBUILD_SHARED_LIBS</span><span class="token operator">=</span>ON <span class="token punctuation">\</span>
       <span class="token parameter variable">-DgRPC_BUILD_TESTS</span><span class="token operator">=</span>OFF <span class="token punctuation">\</span>
       <span class="token parameter variable">-DgRPC_ZLIB_PROVIDER</span><span class="token operator">=</span>package <span class="token punctuation">\</span>
       <span class="token parameter variable">-DgRPC_PROTOBUF_PROVIDER</span><span class="token operator">=</span>package <span class="token punctuation">\</span>
       <span class="token parameter variable">-DgRPC_SSL_PROVIDER</span><span class="token operator">=</span>package <span class="token punctuation">\</span>
       <span class="token parameter variable">-DProtobuf_INCLUDE_DIR</span><span class="token operator">=</span>/usr/local/protobuf/include <span class="token punctuation">\</span>
       <span class="token parameter variable">-DProtobuf_LIBRARY</span><span class="token operator">=</span>/usr/local/protobuf/lib/libprotobuf.so <span class="token punctuation">\</span>
       <span class="token parameter variable">-DProtobuf_PROTOC_LIBRARY</span><span class="token operator">=</span>/usr/local/protobuf/lib/libprotoc.so <span class="token punctuation">\</span>
       <span class="token parameter variable">-DProtobuf_PROTOC_EXECUTABLE</span><span class="token operator">=</span>/usr/local/protobuf/bin/protoc <span class="token punctuation">..</span>/<span class="token punctuation">..</span>
<span class="token function">make</span> <span class="token parameter variable">-j8</span>
<span class="token function">make</span> <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><img src="/assets/img/grpc_build_finish.1410a81d.png" alt="build grpc finish"></p> <h3 id="_4-2-简单的测试"><a href="#_4-2-简单的测试" class="header-anchor">#</a> 4.2 简单的测试</h3> <h4 id="_4-2-1-proto文件准备"><a href="#_4-2-1-proto文件准备" class="header-anchor">#</a> 4.2.1 proto文件准备</h4> <p>使用example中的helloworld进行测试，文件为：https://github.com/grpc/grpc/blob/master/examples/protos/helloworld.proto</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># helloworld.proto</span>
syntax <span class="token operator">=</span> <span class="token string">&quot;proto3&quot;</span><span class="token punctuation">;</span>

package helloworld<span class="token punctuation">;</span>

// The greeting <span class="token function">service</span> definition.
<span class="token function">service</span> Greeter <span class="token punctuation">{</span>
  // Sends a greeting
  rpc SayHello <span class="token punctuation">(</span>HelloRequest<span class="token punctuation">)</span> returns <span class="token punctuation">(</span>HelloReply<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// The request message containing the user's name.
message HelloRequest <span class="token punctuation">{</span>
  string name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

// The response message containing the greetings
message HelloReply <span class="token punctuation">{</span>
  string message <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="_4-2-2-执行简单的测试初体验"><a href="#_4-2-2-执行简单的测试初体验" class="header-anchor">#</a> 4.2.2 执行简单的测试初体验</h4> <h5 id="_4-2-2-1-编译、启动服务端程序"><a href="#_4-2-2-1-编译、启动服务端程序" class="header-anchor">#</a> 4.2.2.1 编译、启动服务端程序</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> examples/cpp/helloworld

<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> cmake/build
<span class="token function">pushd</span> cmake/build
cmake <span class="token parameter variable">-DCMAKE_PREFIX_PATH</span><span class="token operator">=</span>/usr/local/protobuf <span class="token punctuation">..</span>/<span class="token punctuation">..</span>
<span class="token function">make</span> <span class="token parameter variable">-j</span>
./gretter_server

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="/assets/img/hello_world_compile.973a3738.png" alt="hello world compile"></p> <p><img src="/assets/img/hello_world_server_run.f832a6ef.png" alt="hello world server run"></p> <h5 id="_4-2-2-2-启动ghz-cli客户端测试程序"><a href="#_4-2-2-2-启动ghz-cli客户端测试程序" class="header-anchor">#</a> 4.2.2.2 启动GHZ CLI客户端测试程序</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>/home/jacen/thirdparty/ghz/ghz <span class="token parameter variable">--insecure</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--proto</span> ./helloworld.proto <span class="token punctuation">\</span>
  <span class="token parameter variable">--call</span> helloworld.Greeter.SayHello <span class="token punctuation">\</span>
  <span class="token parameter variable">-d</span> <span class="token string">'{&quot;name&quot;:&quot;Joe&quot;}'</span> <span class="token punctuation">\</span>
  <span class="token number">0.0</span>.0.0:50051

<span class="token comment"># 或者利用server reflection 忽略proto</span>
/home/jacen/thirdparty/ghz/ghz <span class="token parameter variable">--insecure</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--call</span> helloworld.Greeter.SayHello <span class="token punctuation">\</span>
  <span class="token parameter variable">-d</span> <span class="token string">'{&quot;name&quot;:&quot;Joe&quot;}'</span> <span class="token punctuation">\</span>
  <span class="token number">0.0</span>.0.0:50051
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>得到结果：</p> <p><img src="/assets/img/hello_world_run_result.b7fd57b5.png" alt="hello world run test result"></p> <h5 id="_4-2-2-3-结果解释"><a href="#_4-2-2-3-结果解释" class="header-anchor">#</a> 4.2.2.3 结果解释</h5> <table><thead><tr><th style="text-align:left;">输出项</th> <th style="text-align:left;">含义</th></tr></thead> <tbody><tr><td style="text-align:left;">count</td> <td style="text-align:left;">已完成的请求总数，包括成功的和失败的请求。</td></tr> <tr><td style="text-align:left;">total</td> <td style="text-align:left;">从开始到结束的测试总时间。</td></tr> <tr><td style="text-align:left;">slowest</td> <td style="text-align:left;">最慢的请求的耗时。</td></tr> <tr><td style="text-align:left;">fastest</td> <td style="text-align:left;">最快的请求的耗时。</td></tr> <tr><td style="text-align:left;">average</td> <td style="text-align:left;">平均的请求耗时.</td></tr> <tr><td style="text-align:left;">requests/sec</td> <td style="text-align:left;">每秒的请求数量，计算公式：count/total。</td></tr></tbody></table> <h2 id="_5-参考资料"><a href="#_5-参考资料" class="header-anchor">#</a> 5 参考资料</h2> <ul><li>ghz</li></ul> <p>https://ghz.sh/</p> <p>https://ghz.sh/docs/output</p> <ul><li>grpc cpp quickstart</li></ul> <p>https://grpc.io/docs/languages/cpp/quickstart/</p> <ul><li>gRPC doc</li></ul> <p>https://doc.oschina.net/grpc?t=57966</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/21/2022, 3:04:02 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/program/cpp/designPattern.html" class="prev">
        23种设计模式（updating）
      </a></span> <span class="next"><a href="/program/paper/gfs.html">
        [SOSP'03] GFS 论文阅读
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.7cef2ded.js" defer></script><script src="/assets/js/2.6425c107.js" defer></script><script src="/assets/js/8.13fc1817.js" defer></script>
  </body>
</html>
